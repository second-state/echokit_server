# Claude Code SeekDB Skill Design

## 1. Overview
This design outlines a Claude Code Skill for the `echokit_server` project to facilitate the integration and management of SeekDB. It serves two primary scenarios:
- **Scenario A (Setup Wizard)**: Guided interactive configuration for new environments.
- **Scenario B (Self-Healing/Sync)**: Automatic detection and correction of configuration drifts.

## 2. Architecture
The system relies on a "Template + Local Override" pattern:
- **Source of Truth (Private)**: `.env` file (local-only, git-ignored).
- **Standards (Public)**: `.env.example` and `config.toml.example` (committed).
- **Consumer**: `config.toml` (generated locally from templates and `.env`).

## 3. Components

### 3.1 Claude Code Skill (`SKILL.md`)
A specialized skill file in `.claude/skills/seekdb-management.md` defining commands:
- `/setup-seekdb`: Interactive wizard to collect host, port, and token.
- `/sync-seekdb`: Regenerates `config.toml` from templates using current `.env` values.

### 3.2 Templates
- `src/resources/.env.example`: Defines required environment variables.
- `src/resources/config.toml.example`: Contains placeholders like `{{SEEKDB_HOST}}`.

## 4. Workflows

### 4.1 Interactive Setup (`/setup-seekdb`)
1. Check for `.env`. If missing, prompt user via `AskUserQuestion`.
2. Offer suggested values (e.g., from the current user session context) as non-persistent placeholders.
3. Write variables to `.env`.
4. Verify `.env` is in `.gitignore`; update `.gitignore` if necessary.

### 4.2 Sync & Self-Healing
1. **Detection**: When AI performs SeekDB tasks, it verifies if `config.toml` exists and matches `.env`.
2. **Generation**: Skill reads `.env` and `config.toml.example`, performs string replacement, and writes to `config.toml`.
3. **Guard**: Adds a header comment: `# [LOCAL_ONLY] GENERATED BY CLAUDE CODE - DO NOT COMMIT`.

### 4.3 Environment Abstraction (The "Proxy" Logic)
- Skill commands will NOT hardcode `proxy`.
- Instead, the Skill will probe for the command via `command -v proxy`.
- If found, it prefixes bash calls dynamically: `proxy && ...`.
- This ensures portability across different development environments.

## 5. Security & Safety
- **Anti-Commit Guard**: Skill logic in `/commit` (if extended) or during file generation will warn if `.env` or `config.toml` are staged for commit.
- **Privacy**: No hardcoded IP addresses or tokens in the code or `SKILL.md`.

## 6. Validation
- After generation, the Skill performs a connectivity test (e.g., `nc` or a simple health check API call) to the SeekDB instance.
- Success/Failure feedback is provided to the user.
